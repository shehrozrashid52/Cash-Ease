{% extends 'base.html' %}

{% block title %}Dashboard - CashEase Banking{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Balance Card -->
<div class="row g-4 mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #662AB2 0%, #7c3aed 100%); border-radius: 20px;">
            <div class="card-body p-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <div class="text-white">
                            <h6 class="text-white-50 mb-2 fw-normal">Available Balance</h6>
                            <h2 class="text-white fw-bold mb-2" style="font-size: 2.5rem;">PKR {{ user.profile.balance|floatformat:2 }}</h2>
                            <div class="d-flex align-items-center gap-3">
                                <div>
                                    <small class="text-white-50">Account Number</small><br>
                                    <span class="text-white fw-semibold">{{ user.profile.account_number }}</span>
                                </div>
                                <div>
                                    <small class="text-white-50">Account Holder</small><br>
                                    <span class="text-white fw-semibold">{{ user.profile.full_name }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="text-white-50">
                            <i class="fas fa-wallet" style="font-size: 4rem; opacity: 0.3;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Stats Overview -->
<div class="row g-4 mb-4">
    <div class="col-xl-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="text-muted mb-2">Total Transactions</h6>
                        <h3 class="mb-0 fw-bold">{{ total_transactions|default:0 }}</h3>
                        <small class="text-success">This month</small>
                    </div>
                    <div class="text-primary">
                        <i class="fas fa-exchange-alt fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="text-muted mb-2">Money Sent</h6>
                        <h3 class="mb-0 fw-bold text-danger">PKR {{ money_sent|default:0|floatformat:2 }}</h3>
                        <small class="text-danger">This month</small>
                    </div>
                    <div class="text-danger">
                        <i class="fas fa-arrow-up fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="text-muted mb-2">Money Received</h6>
                        <h3 class="mb-0 fw-bold text-success">PKR {{ money_received|default:0|floatformat:2 }}</h3>
                        <small class="text-success">This month</small>
                    </div>
                    <div class="text-success">
                        <i class="fas fa-arrow-down fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row g-4 mb-4">
    <div class="col-12">
        <h5 class="mb-3 fw-bold">Quick Actions</h5>
        <div class="row g-3">
            <div class="col-lg-3 col-md-6">
                <a href="{% url 'transactions:send_money' %}" class="card text-decoration-none h-100">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <div class="d-inline-flex align-items-center justify-content-center rounded-circle" 
                                 style="width: 60px; height: 60px; background: linear-gradient(135deg, #ef4444, #dc2626);">
                                <i class="fas fa-paper-plane fa-lg text-white"></i>
                            </div>
                        </div>
                        <h6 class="card-title text-dark">Send Money</h6>
                        <p class="card-text text-muted small">Transfer funds to other users</p>
                    </div>
                </a>
            </div>
            <div class="col-lg-3 col-md-6">
                <a href="{% url 'transactions:request_money' %}" class="card text-decoration-none h-100">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <div class="d-inline-flex align-items-center justify-content-center rounded-circle" 
                                 style="width: 60px; height: 60px; background: linear-gradient(135deg, #10b981, #059669);">
                                <i class="fas fa-hand-holding-usd fa-lg text-white"></i>
                            </div>
                        </div>
                        <h6 class="card-title text-dark">Request Money</h6>
                        <p class="card-text text-muted small">Request payment from contacts</p>
                    </div>
                </a>
            </div>
            <div class="col-lg-3 col-md-6">
                <a href="{% url 'transactions:pay_bill' %}" class="card text-decoration-none h-100">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <div class="d-inline-flex align-items-center justify-content-center rounded-circle" 
                                 style="width: 60px; height: 60px; background: linear-gradient(135deg, #f59e0b, #d97706);">
                                <i class="fas fa-file-invoice-dollar fa-lg text-white"></i>
                            </div>
                        </div>
                        <h6 class="card-title text-dark">Pay Bills</h6>
                        <p class="card-text text-muted small">Pay utility and service bills</p>
                    </div>
                </a>
            </div>
            <div class="col-lg-3 col-md-6">
                <a href="{% url 'transactions:generate_qr' %}" class="card text-decoration-none h-100">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <div class="d-inline-flex align-items-center justify-content-center rounded-circle" 
                                 style="width: 60px; height: 60px; background: linear-gradient(135deg, #662AB2, #7c3aed);">
                                <i class="fas fa-qrcode fa-lg text-white"></i>
                            </div>
                        </div>
                        <h6 class="card-title text-dark">QR Payment</h6>
                        <p class="card-text text-muted small">Generate or scan QR codes</p>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Recent Transactions -->
    <div class="col-xl-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center bg-white">
                <h6 class="mb-0 fw-bold">Recent Transactions</h6>
                <a href="{% url 'transactions:transaction_history' %}" class="btn btn-outline-primary btn-sm">
                    View All
                </a>
            </div>
            <div class="card-body p-0">
                {% if recent_transactions %}
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="border-0">Type</th>
                                    <th class="border-0">Description</th>
                                    <th class="border-0">Amount</th>
                                    <th class="border-0">Status</th>
                                    <th class="border-0">Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for transaction in recent_transactions %}
                                <tr style="cursor: pointer;" onclick="window.location.href='{% url 'transactions:transaction_detail' transaction.transaction_id %}'">
                                    <td>
                                        {% if transaction.transaction_type == 'send' %}
                                            <span class="badge bg-danger-subtle text-danger">
                                                <i class="fas fa-arrow-up me-1"></i>Send
                                            </span>
                                        {% elif transaction.transaction_type == 'receive' %}
                                            <span class="badge bg-success-subtle text-success">
                                                <i class="fas fa-arrow-down me-1"></i>Receive
                                            </span>
                                        {% elif transaction.transaction_type == 'bill_payment' %}
                                            <span class="badge bg-warning-subtle text-warning">
                                                <i class="fas fa-file-invoice me-1"></i>Bill
                                            </span>
                                        {% else %}
                                            <span class="badge bg-primary-subtle text-primary">
                                                <i class="fas fa-exchange-alt me-1"></i>Other
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td class="fw-medium">{{ transaction.description|truncatechars:40 }}</td>
                                    <td>
                                        {% if transaction.transaction_type == 'send' or transaction.transaction_type == 'bill_payment' %}
                                            <span class="text-danger fw-bold">-PKR {{ transaction.amount|floatformat:2 }}</span>
                                        {% elif transaction.transaction_type == 'receive' or transaction.transaction_type == 'deposit' %}
                                            <span class="text-success fw-bold">+PKR {{ transaction.amount|floatformat:2 }}</span>
                                        {% else %}
                                            <span class="fw-bold">PKR {{ transaction.amount|floatformat:2 }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if transaction.status == 'completed' %}
                                            <span class="badge bg-success">Completed</span>
                                        {% elif transaction.status == 'pending' %}
                                            <span class="badge bg-warning">Pending</span>
                                        {% else %}
                                            <span class="badge bg-danger">Failed</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-muted">{{ transaction.created_at|date:"M d, H:i" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-receipt fa-3x text-muted mb-3"></i>
                        <h6 class="text-muted">No transactions yet</h6>
                        <p class="text-muted">Start by sending money or making a payment</p>
                        <a href="{% url 'transactions:send_money' %}" class="btn btn-primary">
                            <i class="fas fa-paper-plane me-2"></i>Send Money
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Account Info & Requests -->
    <div class="col-xl-4">
        <!-- Pending Requests -->
        {% if pending_requests %}
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0 fw-bold">Pending Money Requests</h6>
            </div>
            <div class="card-body">
                {% for request in pending_requests %}
                <div class="d-flex justify-content-between align-items-center mb-3 p-3 bg-light rounded">
                    <div>
                        <h6 class="mb-1 fw-bold">PKR {{ request.amount }}</h6>
                        <small class="text-muted">from {{ request.requester.get_full_name }}</small>
                        {% if request.message %}
                            <div><small class="text-muted">"{{ request.message }}"</small></div>
                        {% endif %}
                    </div>
                    <div>
                        <form method="post" action="{% url 'transactions:respond_request' request.id %}" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="accept">
                            <button type="submit" class="btn btn-success btn-sm me-1">Accept</button>
                        </form>
                        <form method="post" action="{% url 'transactions:respond_request' request.id %}" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="decline">
                            <button type="submit" class="btn btn-outline-danger btn-sm">Decline</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Account Information -->
        <div class="card">
            <div class="card-header bg-white">
                <h6 class="mb-0 fw-bold">Account Information</h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <small class="text-muted">Account Number</small>
                    <div class="fw-bold">{{ user.profile.account_number }}</div>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Account Holder</small>
                    <div class="fw-bold">{{ user.profile.full_name }}</div>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Member Since</small>
                    <div class="fw-bold">{{ user.date_joined|date:"F Y" }}</div>
                </div>
                <div class="mb-0">
                    <small class="text-muted">Account Status</small>
                    <div>
                        {% if user.is_verified %}
                            <span class="badge bg-success">
                                <i class="fas fa-check-circle me-1"></i>Verified
                            </span>
                        {% else %}
                            <span class="badge bg-warning">
                                <i class="fas fa-clock me-1"></i>Pending Verification
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}